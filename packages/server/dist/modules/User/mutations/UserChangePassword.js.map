{"version":3,"sources":["../../../../src/modules/User/mutations/UserChangePassword.ts"],"names":["name","inputFields","oldPassword","type","GraphQLNonNull","GraphQLString","newPassword","mutateAndGetPayload","user","error","correctPassword","authenticate","password","save","success","outputFields","errorField","successField"],"mappings":";;;;;;;AAAA;;AACA;;AAEA;;;;;;;;;;;;eASe,gDAA6B;AAC1CA,EAAAA,IAAI,EAAE,oBADoC;AAE1CC,EAAAA,WAAW,EAAE;AACXC,IAAAA,WAAW,EAAE;AACXC,MAAAA,IAAI,EAAE,IAAIC,uBAAJ,CAAmBC,sBAAnB;AADK,KADF;AAIXC,IAAAA,WAAW,EAAE;AACXH,MAAAA,IAAI,EAAE,IAAIC,uBAAJ,CAAmBC,sBAAnB;AADK;AAJF,GAF6B;AAU1CE,EAAAA,mBAAmB;AAAA,iCAAE,WACnB;AAAEL,MAAAA,WAAF;AAAeI,MAAAA;AAAf,KADmB,EAEnB;AAAEE,MAAAA;AAAF,KAFmB,EAGhB;AACH,UAAI,CAACA,IAAL,EAAW;AACT,eAAO;AACLC,UAAAA,KAAK,EAAE;AADF,SAAP;AAGD;;AAED,YAAMC,eAAe,GAAGF,IAAI,CAACG,YAAL,CAAkBT,WAAlB,CAAxB;;AAEA,UAAI,CAACQ,eAAL,EAAsB;AACpB,eAAO;AACLD,UAAAA,KAAK,EAAE;AADF,SAAP;AAGD;;AAEDD,MAAAA,IAAI,CAACI,QAAL,GAAgBN,WAAhB;AACA,YAAME,IAAI,CAACK,IAAL,EAAN;AAEA,aAAO;AACLC,QAAAA,OAAO,EAAE,+BADJ;AAELL,QAAAA,KAAK,EAAE;AAFF,OAAP;AAID,KAzBkB;;AAAA;AAAA;AAAA;AAAA,KAVuB;AAoC1CM,EAAAA,YAAY,kCACPC,oBADO,GAEPC,sBAFO;AApC8B,CAA7B,C","sourcesContent":["import { GraphQLString, GraphQLNonNull } from \"graphql\";\nimport { mutationWithClientMutationId } from \"graphql-relay\";\n\nimport { errorField, successField } from \"@playground/graphql\";\n\nimport { GraphQLContext } from \"../../../types\";\n\ntype UserChangePasswordArgs = {\n  oldPassword: string;\n  newPassword: string;\n};\n\nexport default mutationWithClientMutationId({\n  name: \"UserChangePassword\",\n  inputFields: {\n    oldPassword: {\n      type: new GraphQLNonNull(GraphQLString),\n    },\n    newPassword: {\n      type: new GraphQLNonNull(GraphQLString),\n    },\n  },\n  mutateAndGetPayload: async (\n    { oldPassword, newPassword }: UserChangePasswordArgs,\n    { user }: GraphQLContext,\n  ) => {\n    if (!user) {\n      return {\n        error: \"User not authenticated\",\n      };\n    }\n\n    const correctPassword = user.authenticate(oldPassword);\n\n    if (!correctPassword) {\n      return {\n        error: \"Invalid password\",\n      };\n    }\n\n    user.password = newPassword;\n    await user.save();\n\n    return {\n      success: \"Password updated successfully\",\n      error: null,\n    };\n  },\n  outputFields: {\n    ...errorField,\n    ...successField,\n  },\n});\n"],"file":"UserChangePassword.js"}