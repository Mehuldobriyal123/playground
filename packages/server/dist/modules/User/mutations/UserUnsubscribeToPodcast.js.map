{"version":3,"sources":["../../../../src/modules/User/mutations/UserUnsubscribeToPodcast.ts"],"names":["name","inputFields","podcastId","type","GraphQLNonNull","GraphQLString","mutateAndGetPayload","user","error","subscribedToPodcast","subscriptions","includes","podcastIdIndex","indexOf","filter","_","index","save","message","outputFields","resolve"],"mappings":";;;;;;;AAAA;;AACA;;;;;;eAQe,gDAA6B;AAC1CA,EAAAA,IAAI,EAAE,0BADoC;AAE1CC,EAAAA,WAAW,EAAE;AACXC,IAAAA,SAAS,EAAE;AACTC,MAAAA,IAAI,EAAE,IAAIC,uBAAJ,CAAmBC,sBAAnB;AADG;AADA,GAF6B;AAO1CC,EAAAA,mBAAmB;AAAA,iCAAE,WACnB;AAAEJ,MAAAA;AAAF,KADmB,EAEnB;AAAEK,MAAAA;AAAF,KAFmB,EAGhB;AACH,UAAI,CAACA,IAAL,EAAW;AACT,eAAO;AACLC,UAAAA,KAAK,EAAE;AADF,SAAP;AAGD;;AAED,YAAMC,mBAAmB,GAAGF,IAAI,CAACG,aAAL,CAAmBC,QAAnB,CAA4BT,SAA5B,CAA5B;;AAEA,UAAIO,mBAAmB,KAAK,IAA5B,EAAkC;AAChC,cAAMG,cAAc,GAAGL,IAAI,CAACG,aAAL,CAAmBG,OAAnB,CAA2BX,SAA3B,CAAvB;AACA,cAAMQ,aAAa,GAAGH,IAAI,CAACG,aAAL,CAAmBI,MAAnB,CACpB,CAACC,CAAD,EAAIC,KAAJ,KAAcA,KAAK,KAAKJ,cADJ,CAAtB;AAIAL,QAAAA,IAAI,CAACG,aAAL,GAAqBA,aAArB;AACA,cAAMH,IAAI,CAACU,IAAL,EAAN;AAEA,eAAO;AACLC,UAAAA,OAAO,EAAE,IADJ;AAELV,UAAAA,KAAK,EAAE;AAFF,SAAP;AAID,OAbD,MAaO;AACL,eAAO;AACLU,UAAAA,OAAO,EAAE,IADJ;AAELV,UAAAA,KAAK,EAAE;AAFF,SAAP;AAID;AACF,KA/BkB;;AAAA;AAAA;AAAA;AAAA,KAPuB;AAuC1CW,EAAAA,YAAY,EAAE;AACZD,IAAAA,OAAO,EAAE;AACPf,MAAAA,IAAI,EAAEE,sBADC;AAEPe,MAAAA,OAAO,EAAE,CAAC;AAAEF,QAAAA;AAAF,OAAD,KAAiBA;AAFnB,KADG;AAKZV,IAAAA,KAAK,EAAE;AACLL,MAAAA,IAAI,EAAEE,sBADD;AAELe,MAAAA,OAAO,EAAE,CAAC;AAAEZ,QAAAA;AAAF,OAAD,KAAeA;AAFnB;AALK;AAvC4B,CAA7B,C","sourcesContent":["import { GraphQLString, GraphQLNonNull } from \"graphql\";\nimport { mutationWithClientMutationId } from \"graphql-relay\";\n\nimport { GraphQLContext } from \"../../../types\";\n\ntype UserSubscribePodcastArgs = {\n  podcastId: string;\n};\n\nexport default mutationWithClientMutationId({\n  name: \"UserUnsubscribeToPodcast\",\n  inputFields: {\n    podcastId: {\n      type: new GraphQLNonNull(GraphQLString),\n    },\n  },\n  mutateAndGetPayload: async (\n    { podcastId }: UserSubscribePodcastArgs,\n    { user }: GraphQLContext,\n  ) => {\n    if (!user) {\n      return {\n        error: \"User not authenticated\",\n      };\n    }\n\n    const subscribedToPodcast = user.subscriptions.includes(podcastId as any);\n\n    if (subscribedToPodcast === true) {\n      const podcastIdIndex = user.subscriptions.indexOf(podcastId as any);\n      const subscriptions = user.subscriptions.filter(\n        (_, index) => index !== podcastIdIndex,\n      );\n\n      user.subscriptions = subscriptions;\n      await user.save();\n\n      return {\n        message: null,\n        error: \"Unsubscribed successfully\",\n      };\n    } else {\n      return {\n        message: null,\n        error: \"Already unsubscribed to podcast\",\n      };\n    }\n  },\n  outputFields: {\n    message: {\n      type: GraphQLString,\n      resolve: ({ message }) => message,\n    },\n    error: {\n      type: GraphQLString,\n      resolve: ({ error }) => error,\n    },\n  },\n});\n"],"file":"UserUnsubscribeToPodcast.js"}